/*
 * DESCBRIDOR DE UID
 * Use este código para descobrir o ID do seu cartão/tag RFID.
 */

#include <SPI.h>
#include <MFRC522.h>

// Pinos para o RFID (Padrão VSPI do ESP32)
#define SS_PIN    5   // SDA/SS
#define RST_PIN   27  // RST
#define MOSI_PIN  23
#define MISO_PIN  19
#define SCK_PIN   18

MFRC522 mfrc522(SS_PIN, RST_PIN);  // Cria a instância do MFRC522

void setup() {
  Serial.begin(115200); // Inicia a comunicação serial
  SPI.begin(SCK_PIN, MISO_PIN, MOSI_PIN, SS_PIN); // Inicia o barramento SPI
  mfrc522.PCD_Init();    // Inicia o MFRC522
  
  Serial.println("Aproxime seu cartao ou tag RFID...");
  Serial.println();
}

void loop() {
  // Procura por novos cartões
  if ( ! mfrc522.PICC_IsNewCardPresent()) {
    return;
  }

  // Seleciona um dos cartões
  if ( ! mfrc522.PICC_ReadCardSerial()) {
    return;
  }

  // Mostra o UID no Monitor Serial
  Serial.print("UID encontrado: ");
  String uidString = "";
  for (byte i = 0; i < mfrc522.uid.size; i++) {
    uidString.concat(String(mfrc522.uid.uidByte[i] < 0x10 ? " 0" : " "));
    uidString.concat(String(mfrc522.uid.uidByte[i], HEX));
  }
  uidString.toUpperCase();
  uidString.trim(); // Remove o espaço inicial
  
  Serial.println(uidString);
  
  delay(1000); // Espera 1 segundo antes de ler novamente
}
